<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Vercal Studio</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
</head>
<body style="background: #000; color: #fff; font-family: 'Cairo'; padding: 20px;">

    <div id="status-msg" style="text-align: center; margin-top: 50px; font-size: 1.2rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ...</div>

    <div id="admin-content" style="display: none; max-width: 600px; margin: 0 auto;">
        <h2 style="text-align: center; color: #5865F2; margin-bottom: 30px;">ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        
        <div style="background: #111; padding: 25px; border-radius: 12px; border: 1px solid #222;">
            <input type="text" id="p-img" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="text" id="p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <textarea id="p-desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" style="height: 80px;"></textarea>
            
            <div style="display: flex; gap: 10px;">
                <input type="text" id="p-price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)">
                <input type="text" id="p-method" placeholder="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (Ù…Ø«Ù„Ø§Ù‹ Credit)">
            </div>
            
            <button onclick="addProduct()" style="width: 100%; padding: 12px; margin-top: 20px; background: #5865F2; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¢Ù†</button>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="window.location.href='shop.html'" style="background: #333; color: #eee; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Ø°Ù‡Ø§Ø¨ Ù„Ù„Ù…ØªØ¬Ø±</button>
        </div>
    </div>

    <script>
        const CLIENT_ID = "1474893422845231177";
        const GUILD_ID = "1328006132043681812"; // Ø³ÙŠØ±ÙØ±Ùƒ
        const REQUIRED_ROLE_ID = "1328006456208588820"; // Ø±ØªØ¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©

        async function checkAuth() {
            const status = document.getElementById('status-msg');
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (!code && !sessionStorage.getItem('access_token')) {
                window.location.href = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&response_type=code&redirect_uri=${encodeURIComponent(window.location.href.split('?')[0])}&scope=identify+guilds.members.read`;
                return;
            }

            try {
                // Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡ Ø¨ÙŠÙƒÙ„Ù… Ø§Ù„Ù€ API Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„Ù†Ø§Ù‡ Ø³ÙˆØ§ Ø¹Ø´Ø§Ù† ÙŠØ´ÙˆÙ Ø§Ù„Ø±ØªØ¨Ø©
                const token = sessionStorage.getItem('access_token') || code;
                const response = await fetch(`https://vercal-studio.vercel.app/api/auth?code=${token}`);
                const data = await response.json();

                if (data.hasRole) {
                    status.style.display = 'none';
                    document.getElementById('admin-content').style.display = 'block';
                    sessionStorage.setItem('isAdmin', 'true');
                    sessionStorage.setItem('access_token', data.token);
                } else {
                    status.innerHTML = "âŒ Ø®Ø·Ø£: Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø±ØªØ¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.";
                    status.style.color = "red";
                }
            } catch (err) {
                status.innerHTML = "âš ï¸ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ø­Ø§ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
            }
        }

        window.onload = checkAuth;
    </script>
    <script src="script.js"></script>
</body>
</html>
